# DeepAgent å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ

## ğŸ¯ æ¦‚è¿°

DeepAgent æ˜¯ä¸€ä¸ªå…ˆè¿›çš„**åˆ†å±‚å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ**ï¼Œé‡‡ç”¨æ™ºèƒ½ä½“åè°ƒæ¶æ„å®ç°å¤æ‚ä»»åŠ¡çš„è‡ªåŠ¨åŒ–æ‰§è¡Œã€‚ç³»ç»ŸåŒ…å«ä¸»æ™ºèƒ½ä½“å’Œå¤šä¸ªä¸“é—¨åŒ–å­æ™ºèƒ½ä½“ï¼Œèƒ½å¤Ÿå¤„ç†ä»ç®€å•å‘½ä»¤åˆ°å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡çš„å„ç§åœºæ™¯ã€‚

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
DeepAgent å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ
â”œâ”€â”€ ğŸ¯ ä¸»æ™ºèƒ½ä½“ (MainAgent)
â”‚   â”œâ”€â”€ ğŸ§  æ„å›¾åˆ†æ - ç†è§£ç”¨æˆ·éœ€æ±‚
â”‚   â”œâ”€â”€ ğŸ“‹ ä»»åŠ¡è§„åˆ’ - åˆ¶å®šæ‰§è¡Œè®¡åˆ’
â”‚   â””â”€â”€ ğŸ­ åè°ƒæ§åˆ¶ - ç®¡ç†å­æ™ºèƒ½ä½“æ‰§è¡Œ
â”‚
â”œâ”€â”€ ğŸ¤– å­æ™ºèƒ½ä½“ (SubAgents)
â”‚   â”œâ”€â”€ ğŸ’» Shell Commander - ç»ˆç«¯å‘½ä»¤æ‰§è¡Œ
â”‚   â”œâ”€â”€ ğŸ“ File System Manager - æ–‡ä»¶æ“ä½œ
â”‚   â”œâ”€â”€ ğŸŒ Chrome Browser Controller - ç½‘é¡µè‡ªåŠ¨åŒ–
â”‚   â”œâ”€â”€ âš™ï¸ MCP Manager - å·¥å…·ç®¡ç†
â”‚   â””â”€â”€ ğŸ’¬ General Assistant - é€šç”¨æŸ¥è¯¢
â”‚
â””â”€â”€ ğŸ”§ æ ¸å¿ƒç»„ä»¶
    â”œâ”€â”€ ğŸ“Š æ•°æ®æ¨¡å‹ - ä»»åŠ¡ã€è®¡åˆ’ã€æ„å›¾
    â”œâ”€â”€ ğŸ›¡ï¸ é”™è¯¯å¤„ç† - é‡è¯•å’Œæ¢å¤æœºåˆ¶
    â”œâ”€â”€ âš¡ å¹¶è¡Œæ‰§è¡Œ - å¹¶å‘ä»»åŠ¡å¤„ç†
    â””â”€â”€ ğŸ”Œ MCP é›†æˆ - å·¥å…·è°ƒç”¨å°è£…
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯¼å…¥å’Œåˆå§‹åŒ–

```python
from app.services.multiagent import deep_agent

# å¼‚æ­¥åˆå§‹åŒ–
await deep_agent.initialize()
```

### 2. åŸºæœ¬ä½¿ç”¨

```python
# æ‰§è¡Œç®€å•å‘½ä»¤
result = await deep_agent.run("åˆ—å‡ºå½“å‰ç›®å½•çš„æ–‡ä»¶")
print(result)

# æ‰§è¡Œå¤æ‚ä»»åŠ¡
result = await deep_agent.run("åˆ›å»ºä¸€ä¸ª Python è„šæœ¬è¯»å–æ–‡ä»¶å†…å®¹å¹¶ç»Ÿè®¡è¡Œæ•°")
print(result)
```

### 3. é«˜çº§ç”¨æ³•

```python
# æŒ‡å®šæ™ºèƒ½ä½“ç±»å‹
result = await deep_agent.execute_simple_command("ls -la", "shell")

# å¸¦ä¸Šä¸‹æ–‡æ‰§è¡Œ
result = await deep_agent.run_with_files(
    user_input="åˆ†æè¿™ä¸ªä»£ç æ–‡ä»¶",
    files={"code.py": file_content}
)

# å¥åº·æ£€æŸ¥
health = await deep_agent.health_check()
print(f"ç³»ç»ŸçŠ¶æ€: {health['status']}")
```

## ğŸ¤– å¯ç”¨æ™ºèƒ½ä½“

### ä¸»æ™ºèƒ½ä½“ (MainAgent)
- **èŒè´£**: æ„å›¾åˆ†æã€ä»»åŠ¡è§„åˆ’ã€æ‰§è¡Œåè°ƒ
- **èƒ½åŠ›**: å¤æ‚ä»»åŠ¡åˆ†è§£ã€å¹¶è¡Œæ‰§è¡Œç®¡ç†ã€é”™è¯¯æ¢å¤
- **é€‚ç”¨åœºæ™¯**: å¤šæ­¥éª¤ä»»åŠ¡ã€éœ€è¦è§„åˆ’çš„å¤æ‚æ“ä½œ

### å­æ™ºèƒ½ä½“è¯¦è§£

#### ğŸ’» Shell Commander (Shell å‘½ä»¤æ‰§è¡Œ)
```python
# è‡ªåŠ¨è°ƒç”¨ Shell å­æ™ºèƒ½ä½“
result = await deep_agent.run("è¿è¡Œ ls -la å‘½ä»¤")
result = await deep_agent.run("åˆ›å»ºä¸€ä¸ªæ–°ç›®å½• test")
```

**æ”¯æŒæ“ä½œ**:
- è¿è¡Œç»ˆç«¯å‘½ä»¤ (`ls`, `cd`, `mkdir`, `rm`, `ps`, `top`)
- æ‰§è¡Œè„šæœ¬å’Œç¨‹åº
- ç³»ç»ŸçŠ¶æ€ç›‘æ§

#### ğŸ“ File System Manager (æ–‡ä»¶ç³»ç»Ÿæ“ä½œ)
```python
result = await deep_agent.run("è¯»å–æ–‡ä»¶ config.txt")
result = await deep_agent.run("åˆ—å‡ºå½“å‰ç›®å½•å†…å®¹")
result = await deep_agent.run("åœ¨é¡¹ç›®ä¸­æœç´¢ 'TODO' å…³é”®å­—")
```

**æ”¯æŒæ“ä½œ**:
- æ–‡ä»¶è¯»å†™æ“ä½œ
- ç›®å½•å¯¼èˆªå’Œç®¡ç†
- æ–‡ä»¶æœç´¢å’Œå†…å®¹æŸ¥æ‰¾

#### ğŸŒ Chrome Browser Controller (æµè§ˆå™¨è‡ªåŠ¨åŒ–)
```python
result = await deep_agent.run("æ‰“å¼€ç™¾åº¦ç½‘ç«™")
result = await deep_agent.run("è®¿é—® https://github.com å¹¶æˆªå›¾")
```

**æ”¯æŒæ“ä½œ**:
- æµè§ˆå™¨å¯åŠ¨å’Œé¡µé¢å¯¼èˆª
- ç½‘é¡µæˆªå›¾
- URL è§£æå’Œæ™ºèƒ½å¯¼èˆª

#### âš™ï¸ MCP Manager (å·¥å…·ç®¡ç†)
```python
result = await deep_agent.run("åˆ—å‡ºæ‰€æœ‰å¯ç”¨å·¥å…·")
result = await deep_agent.run("å®‰è£…æ–°çš„ MCP å·¥å…·")
```

**æ”¯æŒæ“ä½œ**:
- å·¥å…·åˆ—è¡¨æŸ¥çœ‹
- å·¥å…·å®‰è£…å’Œç®¡ç†
- ç³»ç»ŸçŠ¶æ€æ£€æŸ¥

#### ğŸ’¬ General Assistant (é€šç”¨åŠ©æ‰‹)
```python
result = await deep_agent.run("ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ")
result = await deep_agent.run("åŒ—äº¬åˆ°å“ˆå°”æ»¨çš„æ—…è¡Œè®¡åˆ’")
```

**æ”¯æŒæ“ä½œ**:
- ä¸€èˆ¬æ€§é—®é¢˜è§£ç­”
- ä¿¡æ¯æŸ¥è¯¢å’Œå»ºè®®
- ç®€å•è§„åˆ’å’Œè¡Œç¨‹åˆ¶å®š

## ğŸ¯ æ„å›¾åˆ†æç³»ç»Ÿ

ç³»ç»Ÿå…·å¤‡å…ˆè¿›çš„æ„å›¾åˆ†æèƒ½åŠ›ï¼Œèƒ½å¤Ÿè‡ªåŠ¨ç†è§£ç”¨æˆ·éœ€æ±‚ï¼š

### æ„å›¾åˆ†ç±»
- `shell_command`: ç»ˆç«¯å‘½ä»¤æ‰§è¡Œ
- `file_operation`: æ–‡ä»¶æ“ä½œ
- `web_browsing`: ç½‘é¡µæµè§ˆ
- `tool_management`: å·¥å…·ç®¡ç†
- `information_query`: ä¿¡æ¯æŸ¥è¯¢
- `complex_task`: å¤æ‚å¤šæ­¥éª¤ä»»åŠ¡

### å¤æ‚åº¦è¯„ä¼°
- **low**: å•ä¸ªç®€å•æ“ä½œ
- **medium**: å¤šä¸ªç›¸å…³æ“ä½œ
- **high**: å¤šæ­¥éª¤å¤æ‚ä»»åŠ¡

### æ¾„æ¸…æœºåˆ¶
å½“æ„å›¾ä¸æ˜ç¡®æ—¶ï¼Œç³»ç»Ÿä¼šä¸»åŠ¨è¯·æ±‚æ¾„æ¸…ï¼š

```python
result = await deep_agent.run("åˆ›å»ºé¡¹ç›®")
# ç³»ç»Ÿä¼šè¯¢é—®ï¼šæ‚¨æƒ³åˆ›å»ºä»€ä¹ˆç±»å‹çš„é¡¹ç›®ï¼Ÿéœ€è¦å“ªäº›æ–‡ä»¶ï¼Ÿ
```

## ğŸ“‹ ä»»åŠ¡è§„åˆ’ä¸æ‰§è¡Œ

### è‡ªåŠ¨è§„åˆ’
å¯¹äºå¤æ‚ä»»åŠ¡ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¶å®šæ‰§è¡Œè®¡åˆ’ï¼š

```python
# å¤æ‚ä»»åŠ¡è‡ªåŠ¨è§„åˆ’
result = await deep_agent.run("""
åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ Web é¡¹ç›®ï¼ŒåŒ…å«ï¼š
1. HTML é¦–é¡µ
2. CSS æ ·å¼æ–‡ä»¶
3. JavaScript äº¤äº’è„šæœ¬
4. åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆç»“æœ
""")
```

### å¹¶è¡Œæ‰§è¡Œ
ç³»ç»Ÿæ”¯æŒä»»åŠ¡çš„å¹¶è¡Œæ‰§è¡Œä»¥æé«˜æ•ˆç‡ï¼š

```python
# ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ«å¯å¹¶è¡Œæ‰§è¡Œçš„ä»»åŠ¡
# ä¾‹å¦‚ï¼šåŒæ—¶åˆ›å»ºå¤šä¸ªæ–‡ä»¶
```

### ä¾èµ–ç®¡ç†
ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»ä¼šè¢«è‡ªåŠ¨å¤„ç†ï¼š

```python
# ç³»ç»Ÿä¼šç¡®ä¿æŒ‰æ­£ç¡®é¡ºåºæ‰§è¡Œï¼š
# 1. å…ˆåˆ›å»ºç›®å½•
# 2. å†åˆ›å»ºæ–‡ä»¶
# 3. æœ€åè¿è¡Œç¨‹åº
```

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†ä¸é‡è¯•

### è‡ªåŠ¨é‡è¯•æœºåˆ¶
```python
@retry_on_failure(max_retries=2, delay=1.0)
async def execute_with_retry():
    # è‡ªåŠ¨é‡è¯•å¤±è´¥çš„æ“ä½œ
```

### è¶…æ—¶æ§åˆ¶
```python
# ä¸ºæ¯ä¸ªä»»åŠ¡è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
result = await deep_agent.run("è€—æ—¶æ“ä½œ", timeout_seconds=300)
```

### ä¼˜é›…é™çº§
- å•ä¸ªä»»åŠ¡å¤±è´¥ä¸å½±å“æ•´ä½“æ‰§è¡Œ
- æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ¢å¤å»ºè®®
- æ”¯æŒæ‰‹åŠ¨å¹²é¢„å’Œé‡æ–°æ‰§è¡Œ

## ğŸ”§ ç³»ç»Ÿç›‘æ§

### å¥åº·æ£€æŸ¥
```python
health = await deep_agent.health_check()
# æ£€æŸ¥æ‰€æœ‰æ™ºèƒ½ä½“çš„çŠ¶æ€
```

### ç»Ÿè®¡ä¿¡æ¯
```python
stats = deep_agent.get_system_info()
# æŸ¥çœ‹ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡ã€æ€§èƒ½æŒ‡æ ‡ç­‰
```

### æ—¥å¿—è®°å½•
ç³»ç»Ÿæä¾›è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—ï¼Œä¾¿äºè°ƒè¯•å’Œä¼˜åŒ–ã€‚

## ğŸ§ª æµ‹è¯•ä¸éªŒè¯

### è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
python -m app.services.multiagent.test_multiagent

# äº¤äº’å¼æµ‹è¯•
python -m app.services.multiagent.test_multiagent interactive
```

### æµ‹è¯•è¦†ç›–
- âœ… åŸºæœ¬åŠŸèƒ½æµ‹è¯•
- âœ… ç®€å•å‘½ä»¤æ‰§è¡Œ
- âœ… å¤æ‚ä»»åŠ¡å¤„ç†
- âœ… æ„å›¾åˆ†æéªŒè¯
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•

## ğŸ“š é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰æ™ºèƒ½ä½“
```python
from app.services.multiagent.base_agent import SubAgent

class CustomAgent(SubAgent):
    def __init__(self):
        super().__init__(
            name="è‡ªå®šä¹‰æ™ºèƒ½ä½“",
            agent_type=AgentType.DYNAMIC,
            system_prompt="æ‚¨çš„è‡ªå®šä¹‰æç¤º",
            capabilities=AgentCapabilities(...)
        )
```

### æ‰©å±• MCP å·¥å…·
```python
# æ·»åŠ æ–°çš„ MCP æœåŠ¡å™¨é›†æˆ
await deep_agent.add_mcp_server("custom_server", config)
```

### æ€§èƒ½ä¼˜åŒ–
```python
# è°ƒæ•´å¹¶å‘è®¾ç½®
deep_agent.set_concurrency_limit(max_concurrent=10)

# é…ç½®ç¼“å­˜ç­–ç•¥
deep_agent.enable_caching(ttl_seconds=3600)
```

## ğŸ”„ è¿ç§»æŒ‡å—

### ä»å•æ™ºèƒ½ä½“è¿ç§»
```python
# æ—§æ–¹å¼
result = await old_agent.run(command)

# æ–°æ–¹å¼ - è‡ªåŠ¨è·¯ç”±
result = await deep_agent.run(command)

# æ–°æ–¹å¼ - æ˜ç¡®æŒ‡å®š
result = await deep_agent.execute_simple_command(command, "shell")
```

### å…¼å®¹æ€§ä¿è¯
- âœ… ä¿æŒç°æœ‰ API æ¥å£
- âœ… æ”¯æŒå‘åå…¼å®¹
- âœ… å¹³æ»‘è¿‡æ¸¡è·¯å¾„

## ğŸš€ æ€§èƒ½ç‰¹æ€§

- **å¹¶è¡Œæ‰§è¡Œ**: æœ€å¤§åŒ–åˆ©ç”¨ç³»ç»Ÿèµ„æº
- **æ™ºèƒ½ç¼“å­˜**: é¿å…é‡å¤æ“ä½œ
- **èµ„æºç®¡ç†**: è‡ªåŠ¨æ¸…ç†å’Œä¼˜åŒ–
- **å¯æ‰©å±•æ€§**: æ”¯æŒåŠ¨æ€æ·»åŠ æ™ºèƒ½ä½“

## ğŸ“ˆ ç›‘æ§å’ŒæŒ‡æ ‡

ç³»ç»Ÿæä¾›ä¸°å¯Œçš„ç›‘æ§æŒ‡æ ‡ï¼š
- ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡
- æ™ºèƒ½ä½“æ€§èƒ½æŒ‡æ ‡
- é”™è¯¯ç‡å’Œæ¢å¤ç‡
- ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ

## ğŸ‰ æ€»ç»“

DeepAgent å¤šæ™ºèƒ½ä½“ç³»ç»Ÿä»£è¡¨äº†æ™ºèƒ½ä½“æŠ€æœ¯çš„æ–°ä¸€ä»£æ¶æ„ï¼Œé€šè¿‡åˆ†å±‚è®¾è®¡å’Œæ™ºèƒ½åè°ƒå®ç°äº†ï¼š

- ğŸ¤– **æ™ºèƒ½åŒ–**: è‡ªåŠ¨æ„å›¾ç†è§£å’Œä»»åŠ¡è§„åˆ’
- âš¡ **é«˜æ€§èƒ½**: å¹¶è¡Œæ‰§è¡Œå’Œèµ„æºä¼˜åŒ–
- ğŸ›¡ï¸ **é«˜å¯é **: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
- ğŸ”§ **æ˜“æ‰©å±•**: æ¨¡å—åŒ–è®¾è®¡æ”¯æŒçµæ´»å®šåˆ¶
- ğŸ“Š **å¯è§‚æµ‹**: å…¨é¢çš„ç›‘æ§å’Œç»Ÿè®¡åŠŸèƒ½

å¼€å§‹ä½¿ç”¨ DeepAgentï¼Œä½“éªŒä¸‹ä¸€ä»£æ™ºèƒ½ä½“ç³»ç»Ÿçš„å¼ºå¤§èƒ½åŠ›ï¼