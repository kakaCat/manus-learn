# 使用轻量级的 Ubuntu 作为基础镜像
FROM ubuntu:22.04

# 设置环境变量，防止安装过程中的交互式提示
ENV DEBIAN_FRONTEND=noninteractive

# 1. 安装基础组件、桌面环境 (Xfce4) 和 VNC 服务端
RUN apt-get update && apt-get install -y \
    xfce4 \
    xfce4-goodies \
    tightvncserver \
    novnc \
    websockify \
    python3 \
    curl \
    && apt-get clean

# 2. 设置 VNC 相关环境变量
ENV USER=root
ENV HOME=/root
ENV DISPLAY=:1

# 3. 配置 VNC 密码 (这里设置为 "password"，实际使用请修改)
RUN mkdir -p /root/.vnc \
    && echo "password" | vncpasswd -f > /root/.vnc/passwd \
    && chmod 600 /root/.vnc/passwd

# 4. 创建 VNC 启动脚本
RUN echo "#!/bin/sh\n\
xrdb \$HOME/.Xresources\n\
startxfce4 &" > /root/.vnc/xstartup \
    && chmod +x /root/.vnc/xstartup

# 5. 暴露端口：5901 (VNC原生端口), 6080 (noVNC Web端口)
EXPOSE 5901 6080

# 6. 启动脚本：同时启动 VNC Server 和 noVNC
CMD vncserver :1 -geometry 1280x800 -depth 24 && \
    /usr/share/novnc/utils/launch.sh --vnc localhost:5901 --listen 6080